<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‡ç”Ÿæ¨¡æ‹Ÿå™¨</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Microsoft YaHei',sans-serif;background:linear-gradient(135deg,#1a1a2e,#16213e,#0f3460);min-height:100vh;color:#e0e0e0}
.container{max-width:800px;margin:0 auto;padding:20px}
h1{text-align:center;font-size:2.5em;margin-bottom:10px;background:linear-gradient(90deg,#e94560,#ff6b6b,#feca57);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{text-align:center;color:#888;margin-bottom:30px}
.btn{background:linear-gradient(135deg,#e94560,#ff6b6b);border:none;color:white;padding:12px 30px;font-size:1em;border-radius:25px;cursor:pointer;margin:5px;transition:all 0.3s}
.btn:hover{transform:translateY(-2px);box-shadow:0 5px 20px rgba(233,69,96,0.4)}
.btn-secondary{background:linear-gradient(135deg,#0f3460,#16213e);border:1px solid #e94560}
.card{background:rgba(255,255,255,0.05);border-radius:15px;padding:25px;margin-bottom:20px;border:1px solid rgba(255,255,255,0.1)}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:15px;margin:20px 0}
.stat-item{background:rgba(233,69,96,0.1);padding:15px;border-radius:10px;text-align:center}
.stat-label{color:#888;font-size:0.9em}
.stat-value{font-size:1.5em;font-weight:bold;color:#e94560}
.event-text{font-size:1.1em;line-height:1.8;margin:20px 0;padding:20px;background:rgba(0,0,0,0.2);border-radius:10px;border-left:4px solid #e94560}
.choices{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px}
.choice-btn{flex:1;min-width:200px;background:linear-gradient(135deg,#16213e,#0f3460);border:1px solid #e94560;color:white;padding:15px;border-radius:10px;cursor:pointer;text-align:left}
.choice-btn:hover{background:linear-gradient(135deg,#e94560,#ff6b6b)}
.ending-list{max-height:400px;overflow-y:auto}
.ending-item{background:rgba(255,255,255,0.03);padding:15px;border-radius:10px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
.ending-item:hover{background:rgba(233,69,96,0.1)}
.ending-item.locked{opacity:0.5;cursor:not-allowed}
.ending-item.completed{border-left:3px solid #4ade80}
.hidden{display:none}
.fade-in{animation:fadeIn 0.5s}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.progress-bar{width:100%;height:10px;background:rgba(255,255,255,0.1);border-radius:5px;overflow:hidden;margin:10px 0}
.progress-fill{height:100%;background:linear-gradient(90deg,#e94560,#ff6b6b);transition:width 0.3s}
.talent-tag{display:inline-block;background:linear-gradient(135deg,#feca57,#ff9f43);color:#1a1a2e;padding:5px 12px;border-radius:15px;font-size:0.85em;margin:3px;font-weight:bold}
.stats-change.positive{color:#4ade80}.stats-change.negative{color:#ef4444}
@media(max-width:600px){h1{font-size:1.8em}.container{padding:15px}.choice-btn{min-width:100%}}
</style>
</head>
<body>
<div class="container">
<h1>é‡ç”Ÿæ¨¡æ‹Ÿå™¨</h1>
<p class="subtitle">æ¯ä¸€æ¬¡äººç”Ÿï¼Œéƒ½æ˜¯å…¨æ–°çš„å¼€å§‹</p>

<div id="mainMenu" class="fade-in">
<div class="card" style="text-align:center">
<p style="margin-bottom:20px;color:#aaa">éšæœºå±æ€§ã€èŒä¸šã€æ€§åˆ«ã€å¤©èµ‹<br>æ¯æ¬¡äº‹ä»¶å¢é•¿1å²<br>ä½“éªŒå„ç§äººç”Ÿç»“å±€...</p>
<button class="btn" onclick="startGame()">å¼€å§‹æ–°äººç”Ÿ</button>
<button class="btn btn-secondary" onclick="showEndings()">æŸ¥çœ‹ç»“å±€</button>
<button class="btn btn-secondary" onclick="showStats()">æˆ‘çš„æ¡£æ¡ˆ</button>
</div>
</div>

<div id="characterCreate" class="hidden">
<div class="card fade-in">
<h2 style="margin-bottom:20px">éšæœºç”Ÿæˆä¸­...</h2>
<div id="randomCharacter"></div>
<div class="choices">
<button class="btn" onclick="confirmCharacter()">å°±è¿™ä¸ªäº†</button>
<button class="btn btn-secondary" onclick="rerollCharacter()">é‡æ–°éšæœº</button>
</div>
</div>
</div>

<div id="gameInterface" class="hidden">
<div class="card fade-in">
<h2>äººç”Ÿç¬¬ <span id="ageDisplay">0</span> å¹´</h2>
<div class="progress-bar"><div class="progress-fill" id="lifeProgress" style="width:0"></div></div>
<div class="stats-grid" id="statsDisplay"></div>
</div>
<div class="card fade-in">
<h3 style="color:#e94560">äº‹ä»¶</h3>
<div class="event-text" id="eventText"></div>
<div class="choices" id="choicesArea"></div>
</div>
</div>

<div id="endingInterface" class="hidden">
<div class="card fade-in">
<h2>ç»“å±€åˆ—è¡¨</h2>
<p style="color:#888;margin:15px 0">å®Œæˆç»“å±€åæ‰èƒ½æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
<div class="ending-list" id="endingList"></div>
<button class="btn" onclick="backToMenu()" style="margin-top:20px">è¿”å›ä¸»èœå•</button>
</div>
</div>

<div id="endingDetail" class="hidden">
<div class="card fade-in">
<h2 id="endingDetailTitle"></h2>
<div id="endingDetailContent"></div>
<button class="btn" onclick="restartGame()" style="margin-top:20px">é‡æ–°å¼€å§‹</button>
<button class="btn btn-secondary" onclick="showEndings()">è¿”å›ç»“å±€åˆ—è¡¨</button>
</div>
</div>

<div id="statsInterface" class="hidden">
<div class="card fade-in">
<h2>äººç”Ÿæ¡£æ¡ˆ</h2>
<div id="playerStats"></div>
<button class="btn" onclick="backToMenu()" style="margin-top:20px">è¿”å›ä¸»èœå•</button>
</div>
</div>
</div>

<script>
const GENDERS=['ç”·','å¥³'];
const CAREERS=[
{name:'ç¨‹åºå‘˜',stats:{IQ:30,MONEY:20,LUCK:10,HP:70,CHA:15},desc:'996æ˜¯ç¦æŠ¥'},
{name:'æ•™å¸ˆ',stats:{IQ:25,MONEY:15,LUCK:20,HP:75,CHA:30},desc:'æ¡ƒææ»¡å¤©ä¸‹'},
{name:'åŒ»ç”Ÿ',stats:{IQ:30,MONEY:25,LUCK:15,HP:65,CHA:20},desc:'æ•‘æ­»æ‰¶ä¼¤'},
{name:'å†›äºº',stats:{IQ:15,MONEY:15,LUCK:20,HP:40,CHA:25},desc:'ä¿å®¶å«å›½'},
{name:'å•†äºº',stats:{IQ:25,MONEY:35,LUCK:15,HP:70,CHA:25},desc:'ä¸€æœ¬ä¸‡åˆ©'},
{name:'å­¦ç”Ÿ',stats:{IQ:20,MONEY:5,LUCK:30,HP:85,CHA:20},desc:'æœæ°”è“¬å‹ƒ'},
{name:'ç§‘å­¦å®¶',stats:{IQ:35,MONEY:25,LUCK:15,HP:70,CHA:15},desc:'æ¢ç´¢çœŸç†'},
{name:'è‰ºæœ¯å®¶',stats:{IQ:25,MONEY:15,LUCK:20,HP:75,CHA:35},desc:'çµé­‚åˆ›ä½œ'}
];
const TALENTS=[
{name:'å¤©æ‰',desc:'æ™ºåŠ›+20%',eff:{IQ_P:20}},
{name:'é­…åŠ›å‡ºä¼—',desc:'é­…åŠ›+20%',eff:{CHA_P:20}},
{name:'è¿æ°”çˆ†è¡¨',desc:'è¿æ°”+20%',eff:{LUCK_P:20}},
{name:'èº«ä½“å¼ºå£®',desc:'ä½“åŠ›+20%',eff:{HP_P:20}},
{name:'è´¢è¿äº¨é€š',desc:'åˆå§‹é‡‘é’±+50%',eff:{MONEY_E:50}},
{name:'å‘½è¿å¤šèˆ›',desc:'è¿æ°”-30%ï¼Œå…¶ä»–+30%',eff:{LUCK_N:30,OTHER:30}},
{name:'çŸ­å‘½',desc:'å¯¿å‘½-20å¹´',eff:{LIFE:-20}},
{name:'å‘½ç¡¬',desc:'æ­»äº¡æ¦‚ç‡-30%',eff:{DEATH_R:30}},
{name:'å­¦ä¹ å¤©æ‰',desc:'æ¯æ¬¡æ™ºåŠ›+2',eff:{IQ_G:2}},
{name:'ç¤¾äº¤è¾¾äºº',desc:'æ¯æ¬¡é­…åŠ›+2',eff:{CHA_G:2}},
{name:'å¹¸è¿å„¿',desc:'æ¯æ¬¡è¿æ°”+2',eff:{LUCK_G:2}}
];
const ENDINGS=[
{id:'peaceful',name:'å®‰è¯¦ç¦»ä¸–',type:'normal',cond:s=>s.age>=70&&s.HP<=10,desc:'åœ¨ç¡æ¢¦ä¸­å®‰ç„¶å»ä¸–'},
{id:'rich',name:'å¯Œç”²ä¸€æ–¹',type:'normal',cond:s=>s.MONEY>=200,desc:'æˆä¸ºäº†å¤§å¯Œç¿'},
{id:'wise',name:'æ™ºæ…§è€äºº',type:'normal',cond:s=>s.age>=60&&s.IQ>=50,desc:'å—äººå°Šæ•¬'},
{id:'heroic',name:'è‹±é›„å£®çƒˆ',type:'normal',cond:s=>s.HP<=0&&s.LUCK>30,desc:'ä¸ºä»–äººçŒ®å‡ºç”Ÿå‘½'},
{id:'car_accident',name:'è½¦ç¥¸èº«äº¡',type:'death',cond:s=>s.HP<=0,desc:'æ„å¤–è½¦ç¥¸',order:1},
{id:'heart_attack',name:'å¿ƒè„ç—…å‘',type:'death',cond:s=>s.age>=50&&s.HP<=0,desc:'å¿ƒè„ç—…å‘ä½œ',order:7},
{id:'cancer',name:'ç™Œç—‡å»ä¸–',type:'death',cond:s=>s.age>=45&&s.HP<=-20,desc:'ä¸ç—…é­”æ–—äº‰',order:8},
{id:'suicide',name:'ç»æœ›ç¦»ä¸–',type:'death',cond:s=>s.HP<=0&&s.LUCK<=5,desc:'å¤±å»å¸Œæœ›',order:9},
{id:'celebrity',name:'æˆä¸ºåäºº',type:'special',cond:s=>s.CHA>=50&&s.age>=30,desc:'æˆä¸ºæ˜æ˜Ÿ'},
{id:'lottery',name:'å½©ç¥¨å¤§å¥–',type:'special',cond:s=>s.MONEY>=150,desc:'ä¸­å¤§å¥–'},
{id:'scientist',name:'ä¼Ÿå¤§ç§‘å­¦å®¶',type:'special',cond:s=>s.IQ>=60&&s.age>=40,desc:'åšå‡ºè´¡çŒ®'},
{id:'family',name:'å®¶åº­ç¾æ»¡',type:'special',cond:s=>s.CHA>=30&&s.MONEY>=50&&s.age>=40,desc:'å¹¸ç¦å®¶åº­'},
{id:'philosopher',name:'å“²äºº',type:'special',cond:s=>s.IQ>=45&&s.age>=50&&s.MONEY<30,desc:'çœ‹ç ´çº¢å°˜'},
{id:'master',name:'ä¸€ä»£å®—å¸ˆ',type:'special',cond:s=>s.IQ>=50&&s.age>=50&&s.CHA>=30,desc:'é¢†åŸŸå·…å³°'},
{id:'criminal',name:'é”’é“›å…¥ç‹±',type:'special',cond:s=>s.MONEY<0,desc:'è¿æ³•çŠ¯ç½ª'},
{id:'adventurer',name:'å†’é™©å®¶',type:'special',cond:s=>s.LUCK>=50&&s.HP>=60,desc:'ç»å†å†’é™©'}
];
const EVENTS=[
{min:0,max:5,texts:[{t:'ä½ è¿˜æ˜¯ä¸ªå©´å„¿ï¼Œçˆ¶æ¯å¾ˆçˆ±ä½ ã€‚',c:[]},{t:'ä½ è¹’è·šå­¦æ­¥ï¼Œæ‘”äº†ä¸€è·¤ã€‚',c:[]}]},
{min:6,max:12,texts:[{t:'ä½ å¼€å§‹ä¸Šå­¦äº†ï¼Œç»“è¯†äº†æ–°æœ‹å‹ã€‚',c:[]},{t:'è€ƒè¯•ä¼˜å¼‚è·è¡¨æ‰¬ï¼',c:[{tx:'ç»§ç»­åŠªåŠ›',e:{IQ:5,LUCK:2}}]},{t:'å’ŒåŒå­¦æ‰“æ¶äº†ã€‚',c:[{tx:'é“æ­‰',e:{CHA:-2,LUCK:-2}},{tx:'åšæŒ',e:{CHA:2,LUCK:-1}}]}]},
{min:13,max:18,texts:[{t:'é’æ˜¥æœŸåˆ°äº†ã€‚',c:[]},{t:'æ”¶åˆ°æƒ…ä¹¦ï¼',c:[{tx:'æ¥å—',e:{CHA:10,LUCK:5}},{tx:'æ‹’ç»',e:{CHA:5,IQ:3}}]},{t:'æ²‰è¿·æ¸¸æˆã€‚',c:[{tx:'æ²‰è¿·',e:{IQ:-5,LUCK:5,MONEY:-10}},{tx:'æ­¢æŸ',e:{IQ:3,LUCK:3}}]}]},
{min:19,max:25,texts:[{t:'å¤§å­¦æ¯•ä¸šï¼Œé¢ä¸´é€‰æ‹©ã€‚',c:[{tx:'æ‰¾å·¥ä½œ',e:{MONEY:10,HP:-5,IQ:2}},{tx:'æ·±é€ ',e:{IQ:10,MONEY:-20}},{tx:'åˆ›ä¸š',e:{MONEY:[50,-80],LUCK:10,HP:-10}}]},{t:'å¼€å§‹æ‹çˆ±ã€‚',c:[{tx:'è®¤çœŸ',e:{CHA:10,LUCK:10,MONEY:-10}},{tx:'éšç¼˜',e:{CHA:5,LUCK:5}}]}]},
{min:26,max:35,texts:[{t:'ç»“å©šç»„å»ºå®¶åº­ã€‚',c:[{tx:'å¹¸ç¦',e:{CHA:10,MONEY:-30,LUCK:10}}]},{t:'æœ‰äº†å­©å­ã€‚',c:[{tx:'åŸ¹å…»',e:{MONEY:-20,CHA:10,HP:-5}}]},{t:'äº‹ä¸šæ™‹å‡ï¼',c:[{tx:'åŠ æ²¹',e:{MONEY:20,CHA:8,LUCK:5}}]}]},
{min:36,max:45,texts:[{t:'å­©å­å›é€†æœŸã€‚',c:[{tx:'æ²Ÿé€š',e:{CHA:5,LUCK:5,HP:-5}},{tx:'ç®¡æ•™',e:{CHA:-5,LUCK:-5,HP:5}}]},{t:'è¡Œä¸šå°æœ‰åæ°”ã€‚',c:[{tx:'ä¿æŒ',e:{CHA:15,MONEY:20,LUCK:5}}]},{t:'èº«ä½“å‡ºé—®é¢˜ã€‚',c:[{tx:'é”»ç‚¼',e:{HP:10,MONEY:-5}},{tx:'ä¸ç®¡',e:{HP:-10,MONEY:5}}]},{t:'ä¸­å½©ç¥¨ï¼',c:[{tx:'å¹¸è¿',e:{MONEY:50,LUCK:20}}]},{t:'é­é‡è¯ˆéª—ã€‚',c:[{tx:'å¸å–',e:{MONEY:-30,IQ:10}}]}]},
{min:46,max:55,texts:[{t:'è€ƒè™‘é€€ä¼‘ã€‚',c:[{tx:'è§„åˆ’',e:{MONEY:15,LUCK:5}},{tx:'äº«ä¹',e:{MONEY:-20,LUCK:10}}]},{t:'å­©å­ç»“å©šã€‚',c:[{tx:'ç¥ç¦',e:{CHA:10,MONEY:-25}}]},{t:'æŠ±å­™å­äº†ã€‚',c:[{tx:'å¤©ä¼¦',e:{CHA:10,LUCK:10,HP:5}}]}]},
{min:56,max:70,texts:[{t:'é€€ä¼‘äº†ã€‚',c:[{tx:'æ—…æ¸¸',e:{MONEY:-30,LUCK:15,HP:-5}},{tx:'å¸¦å­™',e:{CHA:10,LUCK:10,HP:5}},{tx:'è¿”è˜',e:{MONEY:20,HP:-10}}]},{t:'è€ä¼´ç”Ÿç—…ã€‚',c:[{tx:'ç…§é¡¾',e:{CHA:10,LUCK:5,HP:-10}},{tx:'æŠ¤å·¥',e:{MONEY:-30,HP:5}}]}]},
{min:71,max:100,texts:[{t:'å›å¿†ä¸€ç”Ÿã€‚',c:[{tx:'æ„Ÿæ…¨',e:{CHA:5,LUCK:5}}]},{t:'èº«ä½“è¡°å¼±ã€‚',c:[{tx:'æ¥å—',e:{HP:-10}}]}]},
{min:0,max:100,rand:true,texts:[{t:'æ¡åˆ°é’±ï¼',c:[{tx:'å¼€å¿ƒ',e:{MONEY:10,LUCK:5}}]},{t:'ä¸¢äº†ä¸œè¥¿ã€‚',c:[{tx:'å€’éœ‰',e:{MONEY:-10,LUCK:-5}}]},{t:'å¸®åŠ©åˆ«äººã€‚',c:[{tx:'åŠ©äºº',e:{CHA:5,LUCK:10}}]},{t:'è¢«äººå¸®åŠ©ã€‚',c:[{tx:'æ„Ÿè°¢',e:{LUCK:8,CHA:3}}]},{t:'ç”Ÿç—…äº†ã€‚',c:[{tx:'å°±åŒ»',e:{MONEY:-15,HP:-5}},{tx:'ç¡¬æ‰›',e:{HP:-15}}]}]}
];
let gs={character:null,stats:null,age:0,endings:[],history:[]},cs=null;
function save(){localStorage.setItem('rebirth',JSON.stringify(gs))}
function load(){const d=localStorage.getItem('rebirth');if(d){gs=JSON.parse(d);return true}return false}
function rand(m,M){return Math.floor(Math.random()*(M-m+1))+m}
function ri(a){return a[Math.floor(Math.random()*a.length)]}
function genChar(){
const g=ri(GENDERS),cr=ri(CAREERS),tcnt=rand(1,3),ts=[],used=new Set();
for(let i=0;i<tcnt;i++){let idx;do{idx=rand(0,TALENTS.length-1)}while(used.has(idx));used.add(idx);ts.push(TALENTS[idx])}
let s={...cr.stats};Object.keys(s).forEach(k=>s[k]=Math.max(1,s[k]+rand(-10,10)));
ts.forEach(t=>{
if(t.eff.IQ_P)s.IQ=Math.floor(s.IQ*1.2);if(t.eff.CHA_P)s.CHA=Math.floor(s.CHA*1.2);
if(t.eff.LUCK_P)s.LUCK=Math.floor(s.LUCK*1.2);if(t.eff.HP_P)s.HP=Math.floor(s.HP*1.2);
if(t.eff.MONEY_E)s.MONEY=Math.floor(s.MONEY*1.5);if(t.eff.OTHER){s.IQ=Math.floor(s.IQ*1.3);s.CHA=Math.floor(s.CHA*1.3);s.HP=Math.floor(s.HP*1.3)}
if(t.eff.LUCK_N)s.LUCK=Math.floor(s.LUCK*0.7)
});s.HP=Math.min(100,s.HP);return{gender:g,career:cr.name,desc:cr.desc,talents:ts,stats:s}
}
function dispChar(c){
let html='<div style="text-align:center"><p style="font-size:1.2em;margin-bottom:15px"><strong>æ€§åˆ«ï¼š</strong>'+c.gender+' <strong>èŒä¸šï¼š</strong>'+c.career+'</p><p style="color:#888;margin-bottom:15px">'+c.desc+'</p><div style="margin-bottom:20px"><strong>å¤©èµ‹ï¼š</strong><br>'+c.talents.map(t=>'<span class="talent-tag">'+t.name+'</span>').join('')+'</div><div class="stats-grid"><div class="stat-item"><div class="stat-label">æ™ºåŠ›</div><div class="stat-value">'+c.stats.IQ+'</div></div><div class="stat-item"><div class="stat-label">ä½“åŠ›</div><div class="stat-value">'+c.stats.HP+'</div></div><div class="stat-item"><div class="stat-label">é­…åŠ›</div><div class="stat-value">'+c.stats.CHA+'</div></div><div class="stat-item"><div class="stat-label">è¿æ°”</div><div class="stat-value">'+c.stats.LUCK+'</div></div><div class="stat-item"><div class="stat-label">é‡‘é’±</div><div class="stat-value">'+c.stats.MONEY+'</div></div></div></div>';
document.getElementById('randomCharacter').innerHTML=html
}
function startGame(){const c=genChar();gs.character=c;gs.stats={...c.stats};gs.age=0;gs.history=[];cs={...c.stats};dispChar(c);show('characterCreate')}
function reroll(){const c=genChar();gs.character=c;gs.stats={...c.stats};cs={...c.stats};dispChar(c)}
function confirmCharacter(){save();gs.age=0;cs={...gs.stats};show('gameInterface');updateStats();nextEvent()}
function updateStats(){const maxAge=80-(gs.character.talents.some(t=>t.eff.LIFE)?20:0);const p=Math.min(100,(gs.age/maxAge)*100);document.getElementById('ageDisplay').textContent=gs.age;document.getElementById('lifeProgress').style.width=p+'%';document.getElementById('statsDisplay').innerHTML='<div class="stat-item"><div class="stat-label">å¹´é¾„</div><div class="stat-value">'+gs.age+'</div></div><div class="stat-item"><div class="stat-label">æ™ºåŠ›</div><div class="stat-value">'+cs.IQ+'</div></div><div class="stat-item"><div class="stat-label">ä½“åŠ›</div><div class="stat-value">'+cs.HP+'</div></div><div class="stat-item"><div class="stat-label">é­…åŠ›</div><div class="stat-value">'+cs.CHA+'</div></div><div class="stat-item"><div class="stat-label">è¿æ°”</div><div class="stat-value">'+cs.LUCK+'</div></div><div class="stat-item"><div class="stat-label">é‡‘é’±</div><div class="stat-value">'+cs.MONEY+'</div></div>'}
function getEvent(){const pool=EVENTS.filter(e=>!e.rand&&gs.age>=e.min&&gs.age<=e.max);const randPool=EVENTS.filter(e=>e.rand);const list=Math.random()>0.6?randPool:pool;return ri(list)}
function nextEvent(){const e=getEvent(),et=ri(e.texts);document.getElementById('eventText').textContent=et.t;const ca=document.getElementById('choicesArea');if(et.c.length===0){ca.innerHTML='<button class="btn" onclick="handleChoice(null)">ç»§ç»­</button>'}else{ca.innerHTML=et.c.map((c,i)=>'<button class="choice-btn" onclick="handleChoice('+i+')">'+c.tx+'</button>').join('')}}
function handleChoice(idx){const e=getEvent(),et=ri(e.texts);let eff={};if(idx!==null&&et.c[idx]){eff=et.c[idx].e||{}}
applyEff(eff)}
function applyEff(eff){const char=gs.character;let logs=[];Object.keys(eff).forEach(k=>{let v=eff[k];if(Array.isArray(v)){const ok=Math.random()>0.4;const val=ok?v[0]:v[1];cs[k]=Math.max(0,(cs[k]||0)+val);logs.push(k+':'+(val>=0?'+':'')+val+(ok?'âœ…':'âŒ'))}else{cs[k]=Math.max(0,(cs[k]||0)+v);logs.push(k+':'+(v>=0?'+':'')+v)}})
char.talents.forEach(t=>{if(t.eff.IQ_G){cs.IQ+=t.eff.IQ_G;logs.push('æ™ºåŠ›:+'+t.eff.IQ_G+'ğŸ')}if(t.eff.CHA_G){cs.CHA+=t.eff.CHA_G;logs.push('é­…åŠ›:+'+t.eff.CHA_G+'ğŸ')}if(t.eff.LUCK_G){cs.LUCK+=t.eff.LUCK_G;logs.push('è¿æ°”:+'+t.eff.LUCK_G+'ğŸ')}})
gs.age++;gs.history.push({age:gs.age,changes:logs});save();updateStats();checkEnding()}
function checkEnding(){let ending=null;for(let en of ENDINGS){if(en.cond&&en.cond({...cs,age:gs.age})){if(!ending||(en.order&&(!ending.order||en.order<ending.order))){ending=en}}}
if(ending){if(!gs.endings.includes(ending.id)){gs.endings.push(ending.id);save()}
showEnding(ending);return}
if(gs.age>=100){showEnding({name:'å¯¿ç»ˆæ­£å¯',type:'normal',desc:'æ´»åˆ°äº†100å²'})}
}
function showEnding(en){let html='<h3 style="color:'+(en.type==='death'?'#ef4444':en.type==='special'?'#feca57':'#4ade80')+'">'+en.name+'</h3><p>'+en.desc+'</p><p style="color:#888;margin-top:15px">äº«å¹´ï¼š'+gs.age+'å²</p>';
if(gs.history.length>0){html+='<div style="margin-top:20px"><h4>äººç”Ÿè½¨è¿¹ï¼š</h4>'+gs.history.slice(-10).map(h=>'<p style="color:#aaa;font-size:0.9em">'+h.age+'å²ï¼š'+h.changes.join('ï¼Œ')+'</p>').join('')+'</div>'}
document.getElementById('endingDetailTitle').innerHTML='ğŸ† '+en.name;document.getElementById('endingDetailContent').innerHTML=html;show('endingDetail')
}
function showEndings(){let html='';ENDINGS.forEach(e=>{const done=gs.endings.includes(e.id);html+='<div class="ending-item '+(done?'completed':'locked')+'" onclick="'+(done?'showEndingDetail(\''+e.id+'\')':'')+'"><span class="ending-name">'+(done?'')+e.name+'</span><span class="ending-status">'+(done?'å·²è¾¾æˆ':'æœªè¾¾æˆ')+'</span></div>'})
document.getElementById('endingList').innerHTML=html;show('endingInterface')}
function showEndingDetail(id){const e=ENDINGS.find(en=>en.id===id);if(e){let html='<h3 style="color:#feca57">'+e.name+'</h3><p>'+e.desc+'</p>';if(gs.history.length>0){html+='<div style="margin-top:20px"><h4>äººç”Ÿè½¨è¿¹ï¼š</h4>'+gs.history.slice(-10).map(h=>'<p style="color:#aaa;font-size:0.9em">'+h.age+'å²ï¼š'+h.changes.join('ï¼Œ')+'</p>').join('')+'</div>'}document.getElementById('endingDetailTitle').innerHTML='ğŸ† '+e.name;document.getElementById('endingDetailContent').innerHTML=html;show('endingDetail')}}
function showStats(){const char=gs.character;if(!char){backToMenu();return}
let html='<div class="stats-grid"><div class="stat-item"><div class="stat-label">æ€»æ¸¸æˆæ¬¡æ•°</div><div class="stat-value">'+(gs.endings.length+1)+'</div></div><div class="stat-item"><div class="stat-label">å·²è§£é”ç»“å±€</div><div class="stat-value">'+gs.endings.length+'/'+ENDINGS.length+'</div></div></div>';if(char){html+='<h3 style="margin:20px 0 15px">å½“å‰è§’è‰²</h3><p><strong>æ€§åˆ«ï¼š</strong>'+char.gender+' <strong>èŒä¸šï¼š</strong>'+char.career+'</p><p style="margin:10px 0">'+char.desc+'</p><div style="margin-top:15px">'+char.talents.map(t=>'<span class="talent-tag">'+t.name+'</span>').join('')+'</div>'}document.getElementById('playerStats').innerHTML=html;show('statsInterface')}
function restartGame(){clearGame();startGame()}
function clearGame(){localStorage.removeItem('rebirth');gs={character:null,stats:null,age:0,endings:[],history:[]};cs=null}
function show(id){['mainMenu','characterCreate','gameInterface','endingInterface','endingDetail','statsInterface'].forEach(i=>document.getElementById(i).classList.add('hidden'));document.getElementById(id).classList.remove('hidden')}
function backToMenu(){show('mainMenu')}
load();
</script>
</body>
</html>
